<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>艾宾浩斯记忆助手</title>
    <!-- 引入Tailwind CSS（简化样式开发） -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome（图标支持） -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind自定义配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // 主色（紫色系，代表专注）
                        secondary: '#10B981', // 完成色（绿色）
                        warning: '#F59E0B', // 待复习色（橙色）
                        danger: '#EF4444', // 紧急复习色（红色）
                        neutral: '#64748B', // 中性色（灰色）
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .transition-custom {
                transition: all 0.3s ease;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 头部标题区 -->
        <header class="mb-10 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 flex items-center justify-center">
                <i class="fa fa-book text-primary mr-3"></i>
                艾宾浩斯记忆助手
            </h1>
            <p class="text-gray-600 mt-2 max-w-2xl mx-auto">
                基于艾宾浩斯遗忘曲线，自动生成复习计划，科学记忆知识点
                <br><span class="text-xs text-gray-500 mt-1 block">关键复习节点：10分钟 → 1小时 → 1天 → 2天 → 4天 → 7天 → 15天</span>
            </p>
        </header>

        <!-- 主要内容区（分栏：移动端堆叠，桌面端左右分栏） -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- 左侧：添加知识点 + 复习说明（占4列） -->
            <div class="lg:col-span-4 space-y-6">
                <!-- 1. 添加知识点卡片 -->
                <div class="bg-white rounded-xl card-shadow p-5 transition-custom hover:shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-plus-circle text-primary mr-2"></i>
                        添加知识点
                    </h2>
                    
                    <form id="knowledge-form" class="space-y-4">
                        <div>
                            <label for="knowledge-title" class="block text-sm font-medium text-gray-700 mb-1">
                                知识点标题 <span class="text-danger">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="knowledge-title" 
                                placeholder="例如：英语四级高频单词list1" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-custom"
                                required
                            >
                        </div>
                        
                        <div>
                            <label for="knowledge-content" class="block text-sm font-medium text-gray-700 mb-1">
                                知识点详情（可选）
                            </label>
                            <textarea 
                                id="knowledge-content" 
                                rows="3" 
                                placeholder="例如：abandon v. 放弃；abide v. 遵守..." 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-custom resize-none"
                            ></textarea>
                        </div>
                        
                        <div>
                            <label for="knowledge-category" class="block text-sm font-medium text-gray-700 mb-1">
                                分类（可选）
                            </label>
                            <select 
                                id="knowledge-category" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-custom"
                            >
                                <option value="默认分类">默认分类</option>
                                <option value="英语">英语</option>
                                <option value="数学">数学</option>
                                <option value="专业知识">专业知识</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        
                        <button 
                            type="submit" 
                            class="w-full bg-primary hover:bg-primary/90 text-white py-2.5 rounded-lg transition-custom flex items-center justify-center font-medium"
                        >
                            <i class="fa fa-save mr-2"></i> 保存并生成复习计划
                        </button>
                    </form>
                </div>
                
                <!-- 2. 复习说明卡片 -->
                <div class="bg-white rounded-xl card-shadow p-5 transition-custom hover:shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-info-circle text-primary mr-2"></i>
                        复习说明
                    </h2>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>添加知识点后，系统自动计算7个复习节点</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>“待复习”任务会标红提醒，点击“完成复习”更新状态</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>知识点完成所有复习节点后，标记为“已掌握”</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>数据存储在本地（清除浏览器缓存会丢失）</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- 右侧：复习任务 + 知识点列表（占8列） -->
            <div class="lg:col-span-8 space-y-6">
                <!-- 1. 今日待复习任务 -->
                <div class="bg-white rounded-xl card-shadow p-5 transition-custom hover:shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fa fa-bell text-warning mr-2"></i>
                            今日待复习任务
                        </h2>
                        <span id="pending-count" class="bg-danger text-white text-xs px-2 py-1 rounded-full">0 个</span>
                    </div>
                    
                    <div id="pending-tasks" class="space-y-3">
                        <!-- 待复习任务会通过JS动态渲染 -->
                        <div class="text-center text-gray-500 py-6">
                            <i class="fa fa-calendar-o text-4xl mb-2"></i>
                            <p>暂无待复习任务，添加知识点开始科学记忆吧！</p>
                        </div>
                    </div>
                </div>
                
                <!-- 2. 所有知识点列表 -->
                <div class="bg-white rounded-xl card-shadow p-5 transition-custom hover:shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fa fa-list text-primary mr-2"></i>
                            所有知识点
                        </h2>
                        <select id="category-filter" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary/30 focus:border-primary">
                            <option value="all">全部分类</option>
                            <option value="默认分类">默认分类</option>
                            <option value="英语">英语</option>
                            <option value="数学">数学</option>
                            <option value="专业知识">专业知识</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    
                    <div id="all-knowledges" class="space-y-4 max-h-[500px] overflow-y-auto pr-2">
                        <!-- 知识点列表会通过JS动态渲染 -->
                        <div class="text-center text-gray-500 py-6">
                            <i class="fa fa-book-open-o text-4xl mb-2"></i>
                            <p>暂无知识点，点击左侧“添加知识点”开始</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 页脚 -->
        <footer class="mt-12 text-center text-gray-500 text-sm py-4 border-t border-gray-200">
            <p>艾宾浩斯记忆助手 &copy; 2024 | 基于艾宾浩斯遗忘曲线设计</p>
        </footer>
    </div>

    <script>
        // -------------------------- 核心数据逻辑 --------------------------
        // 1. 艾宾浩斯复习节点（单位：分钟）：10分钟、1小时、1天、2天、4天、7天、15天
        const reviewIntervals = [10, 60, 1440, 2880, 5760, 10080, 21600];
        
        // 2. 本地存储工具类
        const StorageUtil = {
            // 获取所有知识点
            getKnowledges() {
                const data = localStorage.getItem('ebbinghausKnowledges');
                return data ? JSON.parse(data) : [];
            },
            
            // 保存知识点
            saveKnowledge(knowledge) {
                const knowledges = this.getKnowledges();
                knowledges.push(knowledge);
                localStorage.setItem('ebbinghausKnowledges', JSON.stringify(knowledges));
            },
            
            // 更新知识点（用于标记复习状态）
            updateKnowledge(id, updatedData) {
                const knowledges = this.getKnowledges();
                const index = knowledges.findIndex(k => k.id === id);
                if (index !== -1) {
                    knowledges[index] = { ...knowledges[index], ...updatedData };
                    localStorage.setItem('ebbinghausKnowledges', JSON.stringify(knowledges));
                    return true;
                }
                return false;
            },
            
            // 删除知识点
            deleteKnowledge(id) {
                let knowledges = this.getKnowledges();
                knowledges = knowledges.filter(k => k.id !== id);
                localStorage.setItem('ebbinghausKnowledges', JSON.stringify(knowledges));
            }
        };
        
        // 3. 时间工具类（计算复习时间、格式化时间）
        const TimeUtil = {
            // 计算所有复习时间（基于当前时间 + 复习间隔）
            calculateReviewTimes() {
                const now = Date.now();
                return reviewIntervals.map(interval => now + interval * 60 * 1000);
            },
            
            // 格式化时间（YYYY-MM-DD HH:MM）
            formatTime(timestamp) {
                const date = new Date(timestamp);
                return `${date.getFullYear()}-${this.padZero(date.getMonth() + 1)}-${this.padZero(date.getDate())} ${this.padZero(date.getHours())}:${this.padZero(date.getMinutes())}`;
            },
            
            // 补零（如：1 → 01）
            padZero(num) {
                return num < 10 ? `0${num}` : num;
            },
            
            // 判断时间是否已到（用于标记待复习）
            isTimeUp(timestamp) {
                return Date.now() >= timestamp;
            }
        };

        // -------------------------- 页面渲染逻辑 --------------------------
        const RenderUtil = {
            // 1. 渲染“今日待复习任务”
            renderPendingTasks() {
                const knowledges = StorageUtil.getKnowledges();
                const pendingTasks = [];
                
                // 筛选出“未完成所有复习”且“当前有到时间的复习节点”的知识点
                knowledges.forEach(knowledge => {
                    if (knowledge.isMastered) return; // 已掌握的跳过
                    
                    const nextReviewIndex = knowledge.reviewedCount;
                    if (nextReviewIndex >= reviewIntervals.length) {
                        // 所有节点已复习，标记为已掌握
                        StorageUtil.updateKnowledge(knowledge.id, { isMastered: true });
                        return;
                    }
                    
                    const nextReviewTime = knowledge.reviewTimes[nextReviewIndex];
                    if (TimeUtil.isTimeUp(nextReviewTime)) {
                        pendingTasks.push(knowledge);
                    }
                });
                
                const pendingTasksEl = document.getElementById('pending-tasks');
                const pendingCountEl = document.getElementById('pending-count');
                
                // 更新待复习数量
                pendingCountEl.textContent = `${pendingTasks.length} 个`;
                
                // 渲染待复习任务
                if (pendingTasks.length === 0) {
                    pendingTasksEl.innerHTML = `
                        <div class="text-center text-gray-500 py-6">
                            <i class="fa fa-check-circle text-secondary text-4xl mb-2"></i>
                            <p>今日暂无待复习任务，继续保持！</p>
                        </div>
                    `;
                    return;
                }
                
                pendingTasksEl.innerHTML = pendingTasks.map(knowledge => `
                    <div class="p-3 border border-danger/30 bg-danger/5 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                        <div class="flex-1">
                            <h3 class="font-medium text-danger">${knowledge.title}</h3>
                            <p class="text-xs text-gray-500 mt-1">
                                分类：${knowledge.category} | 下次复习：${TimeUtil.formatTime(knowledge.reviewTimes[knowledge.reviewedCount])}
                            </p>
                            ${knowledge.content ? `<p class="text-sm text-gray-600 mt-2">${knowledge.content}</p>` : ''}
                        </div>
                        <button 
                            class="review-btn self-end sm:self-auto px-4 py-1.5 bg-secondary hover:bg-secondary/90 text-white rounded-lg text-sm transition-custom"
                            data-id="${knowledge.id}"
                        >
                            完成复习
                        </button>
                    </div>
                `).join('');
                
                // 绑定“完成复习”按钮事件
                this.bindReviewButtons();
            },
            
            // 2. 渲染“所有知识点列表”
            renderAllKnowledges(category = 'all') {
                let knowledges = StorageUtil.getKnowledges();
                
                // 按分类筛选
                if (category !== 'all') {
                    knowledges = knowledges.filter(k => k.category === category);
                }
                
                // 按“是否已掌握”+“最近复习时间”排序（未掌握在前，已掌握在后）
                knowledges.sort((a, b) => {
                    if (a.isMastered !== b.isMastered) {
                        return a.isMastered ? 1 : -1;
                    }
                    // 未掌握的按“下次复习时间”升序（早到的在前）
                    const aNextTime = a.reviewTimes[a.reviewedCount] || Infinity;
                    const bNextTime = b.reviewTimes[b.reviewedCount] || Infinity;
                    return aNextTime - bNextTime;
                });
                
                const allKnowledgesEl = document.getElementById('all-knowledges');
                
                if (knowledges.length === 0) {
                    allKnowledgesEl.innerHTML = `
                        <div class="text-center text-gray-500 py-6">
                            <i class="fa fa-book-open-o text-4xl mb-2"></i>
                            <p>暂无知识点，点击左侧“添加知识点”开始</p>
                        </div>
                    `;
                    return;
                }
                
                allKnowledgesEl.innerHTML = knowledges.map(knowledge => {
                    // 计算当前状态文本
                    let statusText, statusClass;
                    if (knowledge.isMastered) {
                        statusText = '已掌握';
                        statusClass = 'bg-secondary/10 text-secondary';
                    } else {
                        const nextReviewIndex = knowledge.reviewedCount;
                        const nextReviewTime = knowledge.reviewTimes[nextReviewIndex];
                        if (TimeUtil.isTimeUp(nextReviewTime)) {
                            statusText = '待复习';
                            statusClass = 'bg-danger/10 text-danger';
                        } else {
                            statusText = `下次复习：${TimeUtil.formatTime(nextReviewTime)}`;
                            statusClass = 'bg-warning/10 text-warning';
                        }
                    }
                    
                    return `
                        <div class="p-4 border border-gray-200 rounded-lg transition-custom hover:shadow-md">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-800">${knowledge.title}</h3>
                                <span class="text-xs px-2 py-1 rounded-full ${statusClass}">${statusText}</span>
                            </div>
                            <p class="text-xs text-gray-500 mb-2">
                                分类：${knowledge.category} | 已复习：${knowledge.reviewedCount}/${reviewIntervals.length} 次
                                | 添加时间：${TimeUtil.formatTime(knowledge.createTime)}
                            </p>
                            ${knowledge.content ? `<p class="text-sm text-gray-600 mb-3">${knowledge.content}</p>` : ''}
                            <div class="flex justify-end gap-2">
                                <button 
                                    class="delete-btn px-3 py-1 border border-gray-300 hover:border-danger hover:text-danger rounded-lg text-xs transition-custom"
                                    data-id="${knowledge.id}"
                                >
                                    <i class="fa fa-trash-o mr-1"></i> 删除
                                </button>
                                ${!knowledge.isMastered ? `
                                    <button 
                                        class="review-btn px-3 py-1 bg-secondary hover:bg-secondary/90 text-white rounded-lg text-xs transition-custom"
                                        data-id="${knowledge.id}"
                                    >
                                        <i class="fa fa-check mr-1"></i> 完成复习
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                // 绑定按钮事件
                this.bindReviewButtons();
                this.bindDeleteButtons();
            },
            
            // 3. 绑定“完成复习”按钮事件
            bindReviewButtons() {
                document.querySelectorAll('.review-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const knowledgeId = this.getAttribute('data-id');
                        const knowledge = StorageUtil.getKnowledges().find(k => k.id === knowledgeId);
                        
                        if (!knowledge) return;
                        
                        // 更新复习次数（+1）
                        const newReviewedCount = knowledge.reviewedCount + 1;
                        const isMastered = newReviewedCount >= reviewIntervals.length;
                        
                        StorageUtil.updateKnowledge(knowledgeId, {
                            reviewedCount: newReviewedCount,
                            isMastered: isMastered
                        });
                        
                        // 重新渲染页面
                        RenderUtil.renderPendingTasks();
                        RenderUtil.renderAllKnowledges(document.getElementById('category-filter').value);
                        
                        // 提示
                        alert(isMastered ? '恭喜！该知识点已完成所有复习，标记为“已掌握”' : '复习成功！已更新复习进度');
                    });
                });
            },
            
            // 4. 绑定“删除”按钮事件
            bindDeleteButtons() {
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const knowledgeId = this.getAttribute('data-id');
                        if (confirm('确定要删除该知识点吗？删除后不可恢复！')) {
                            StorageUtil.deleteKnowledge(knowledgeId);
                            // 重新渲染页面
                            RenderUtil.renderPendingTasks();
                            RenderUtil.renderAllKnowledges(document.getElementById('category-filter').value);
                        }
                    });
                });
            }
        };

        // -------------------------- 页面初始化逻辑 --------------------------
        document.addEventListener('DOMContentLoaded', function() {
            // 1. 绑定“添加知识点”表单提交事件
            const knowledgeForm = document.getElementById('knowledge-form');
            knowledgeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 获取表单数据
                const newKnowledge = {
                    id: Date.now().toString(), // 用时间戳作为唯一ID
                    title: document.getElementById('knowledge-title').value.trim(),
                    content: document.getElementById('knowledge-content').value.trim(),
                    category: document.getElementById('knowledge-category').value,
                    createTime: Date.now(),
                    reviewTimes: TimeUtil.calculateReviewTimes(), // 计算7个复习时间点
                    reviewedCount: 0, // 已复习次数（初始为0）
                    isMastered: false // 是否已掌握（初始为false）
                };
                
                // 保存知识点
                StorageUtil.saveKnowledge(newKnowledge);
                
                // 重置表单
                knowledgeForm.reset();
                
                // 重新渲染页面
                RenderUtil.renderPendingTasks();
                RenderUtil.renderAllKnowledges(document.getElementById('category-filter').value);
                
                // 提示
                alert('知识点添加成功！已自动生成复习计划');
            });
            
            // 2. 绑定“分类筛选”事件
            const categoryFilter = document.getElementById('category-filter');
            categoryFilter.addEventListener('change', function() {
                RenderUtil.renderAllKnowledges(this.value);
            });
            
            // 3. 初始化渲染页面
            RenderUtil.renderPendingTasks();
            RenderUtil.renderAllKnowledges();
            
            // 4. 每5分钟自动刷新一次（检测是否有新的待复习任务）
            setInterval(() => {
                RenderUtil.renderPendingTasks();
                RenderUtil.renderAllKnowledges(document.getElementById('category-filter').value);
            }, 5 * 60 * 1000);
        });
    </script>
</body>
</html>